# ğŸŒŠ WavyOS Command Center
# Standardizing maintenance for Apple Silicon.

# List available commands
default:
    @just --list

# ğŸš€ SETUP & HYDRATION
# Run the full "Day 1" setup (Apps + Brew + Dev)

# We use the absolute path to ensure we find the script we baked into the image
setup:
    @echo "ğŸŒŠ Initializing WavyOS Environment..."
    @/usr/bin/setup-user.sh

# Enter the developer environment (Distrobox)

# This is the shortcut for "distrobox enter dev"
dev:
    distrobox enter dev

# ğŸš€ SYSTEM MAINTENANCE

# Update everything (OS, Apps, Brew, Containers)
update:
    @echo "ğŸŒŠ Updating WavyOS System..."
    sudo bootc upgrade
    @echo "ğŸ“¦ Updating Flatpaks..."
    flatpak update -y
    @echo "ğŸº Updating Homebrew..."
    @if [ -d "/home/linuxbrew/.linuxbrew" ]; then eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)" && brew update && brew upgrade; fi
    @echo "ğŸ› ï¸  Updating Distrobox..."
    distrobox upgrade --all
    @echo "âœ¨ Update Complete. Reboot if system layers changed."

# Clean up garbage (Old images, unused flatpaks)
clean:
    @echo "ğŸ§¹ Cleaning System..."
    podman system prune -a -f
    flatpak uninstall --unused -y
    rpm-ostree cleanup -m
    @echo "âœ¨ Sparkle clean."

# ğŸ› ï¸ UTILITIES

# Force audio fix (if sound gets janky)
fix-audio:
    @echo "ğŸ”Š Resetting Wireplumber..."
    systemctl --user restart wireplumber pipewire
    @echo "âœ… Audio stack restarted."

# View system logs (The "Console.app" equivalent)
logs:
    gnome-logs

# âš¡ï¸ POWER USER

# Switch to the 'dev' branch (Beta channel)
switch-dev:
    @echo "âš ï¸  Switching to Unstable/Dev Channel..."
    sudo bootc switch ghcr.io/ericrowan/asahi-atomic:dev

# Switch to the 'main' branch (Stable channel)
switch-stable:
    @echo "ğŸ›¡ï¸  Switching to Stable Channel..."
    sudo bootc switch ghcr.io/ericrowan/asahi-atomic:latest

# Pin the current deployment (Prevent auto-deletion)
pin:
    sudo ostree admin pin 0
